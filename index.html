<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WebAuthn Explorer ‚Äî Understand & Test WebAuthn Features</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --bg-card: #0b1020;
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.15);
      --accent-purple: #8b5cf6;
      --accent-teal: #14b8a6;
      --danger: #ef4444;
      --success: #22c55e;
      --warning: #eab308;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.2);
      --radius-xl: 18px;
      --radius-lg: 14px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.9);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(ellipse at top, #111827 0%, #020617 50%, #000 100%);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px;
    }

    .app-shell {
      max-width: 1280px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* ===== Header ===== */
    header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 16px;
      align-items: flex-start;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    h1 {
      margin: 0;
      font-size: 1.8rem;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
    }

    .subtitle {
      margin: 0;
      font-size: 0.92rem;
      color: var(--text-muted);
      max-width: 550px;
      line-height: 1.5;
    }

    .header-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }

    .pill {
      font-size: 0.72rem;
      padding: 5px 12px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid var(--border-subtle);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-muted);
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    .browser-pill {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    /* ===== Navigation Tabs ===== */
    .nav-tabs {
      display: flex;
      gap: 6px;
      padding: 6px;
      background: rgba(15, 23, 42, 0.6);
      border-radius: 16px;
      border: 1px solid var(--border-subtle);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .nav-tab {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      border-radius: 12px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.15s ease-out;
    }

    .nav-tab:hover {
      color: var(--text-main);
      background: rgba(255, 255, 255, 0.05);
    }

    .nav-tab.active {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
      color: white;
      box-shadow: 0 2px 12px rgba(59, 130, 246, 0.2);
    }

    .nav-tab-icon {
      font-size: 1.1rem;
    }

    .nav-tab-badge {
      font-size: 0.65rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(34, 197, 94, 0.2);
      color: var(--success);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* ===== Main Content ===== */
    main {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .check-section {
      display: none;
    }

    .check-section.active {
      display: block;
    }

    .section-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .section-title-block h2 {
      margin: 0;
      font-size: 1.3rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title-block p {
      margin: 4px 0 0;
      font-size: 0.85rem;
      color: var(--text-muted);
      max-width: 600px;
    }

    .section-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* ===== Buttons ===== */
    button.primary {
      border: none;
      outline: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 0.88rem;
      font-weight: 500;
      letter-spacing: 0.02em;
      background: linear-gradient(135deg, #2563eb, #7c3aed);
      color: white;
      box-shadow: 0 8px 24px rgba(37, 99, 235, 0.4);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.1s ease-out, box-shadow 0.15s ease-out, filter 0.15s ease-out;
    }

    button.primary:hover {
      transform: translateY(-2px);
      filter: brightness(1.08);
      box-shadow: 0 12px 32px rgba(37, 99, 235, 0.55);
    }

    button.primary:active {
      transform: translateY(0);
      filter: brightness(0.95);
    }

    button.secondary {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.8);
      color: var(--text-muted);
      padding: 8px 16px;
      font-size: 0.82rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.12s ease-out;
    }

    button.secondary:hover {
      border-color: rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
      filter: none !important;
    }

    /* ===== Cards ===== */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 18px;
    }

    @media (max-width: 840px) {
      .card-grid {
        grid-template-columns: 1fr;
      }
    }

    .card {
      border-radius: var(--radius-xl);
      background: radial-gradient(ellipse at top left, #111827 0%, #020617 70%);
      border: 1px solid rgba(30, 64, 175, 0.35);
      box-shadow: var(--shadow-soft);
      padding: 18px 20px 20px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -50%;
      background:
        radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.1) 0, transparent 50%),
        radial-gradient(circle at 100% 0, rgba(139, 92, 246, 0.1) 0, transparent 45%);
      opacity: 0.8;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .card-title {
      font-size: 0.88rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #9ca3af;
    }

    .card-subtitle {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    /* ===== Status Badges ===== */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.96);
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
    }

    .badge.ok .badge-dot { background: var(--success); box-shadow: 0 0 8px rgba(34, 197, 94, 0.7); }
    .badge.warn .badge-dot { background: var(--warning); box-shadow: 0 0 8px rgba(234, 179, 8, 0.7); }
    .badge.error .badge-dot { background: var(--danger); box-shadow: 0 0 8px rgba(239, 68, 68, 0.7); }

    /* ===== Section Labels ===== */
    .section-label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
      border-bottom: 1px dashed rgba(148, 163, 184, 0.35);
      padding-bottom: 5px;
      margin-bottom: 8px;
    }

    /* ===== Capability / Check Items ===== */
    .check-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .check-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 12px 14px;
      background: rgba(15, 23, 42, 0.55);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.08);
      transition: border-color 0.15s, background 0.15s;
    }

    .check-item:hover {
      border-color: rgba(148, 163, 184, 0.2);
      background: rgba(15, 23, 42, 0.75);
    }

    .check-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .check-item-name {
      font-size: 0.85rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .check-item-status {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.25);
    }

    .check-item-status.supported { color: var(--success); }
    .check-item-status.not-supported { color: var(--danger); }
    .check-item-status.unknown { color: var(--warning); }

    .check-item-description {
      font-size: 0.78rem;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .check-item-summary {
      font-size: 0.8rem;
      color: var(--text-muted);
      line-height: 1.5;
      margin-bottom: 6px;
    }

    .check-item-details {
      display: none;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed rgba(148, 163, 184, 0.2);
    }

    .check-item.expanded .check-item-details {
      display: flex;
    }

    .check-item-toggle {
      font-size: 0.72rem;
      color: var(--accent);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      margin-top: 8px;
      padding: 4px 8px;
      background: rgba(59, 130, 246, 0.1);
      border-radius: 6px;
      transition: all 0.15s ease-out;
    }

    .check-item-toggle:hover {
      background: rgba(59, 130, 246, 0.2);
    }

    .check-item-toggle span:first-child {
      font-size: 0.6rem;
      transition: transform 0.2s ease-out;
    }

    .check-item.expanded .check-item-toggle span:first-child {
      transform: rotate(90deg);
    }

    .check-item.expanded .check-item-toggle .toggle-text {
      display: none;
    }

    .check-item.expanded .check-item-toggle .toggle-text-collapse {
      display: inline;
    }

    .check-item-toggle .toggle-text-collapse {
      display: none;
    }

    .detail-point {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .detail-icon {
      font-size: 0.9rem;
      flex-shrink: 0;
      width: 20px;
      text-align: center;
    }

    .detail-content {
      flex: 1;
    }

    .detail-title {
      font-size: 0.82rem;
      font-weight: 500;
      color: var(--text-main);
      margin-bottom: 2px;
    }

    .detail-explanation {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-style: italic;
    }

    .use-case-box {
      margin-top: 8px;
      padding: 10px 12px;
      background: rgba(59, 130, 246, 0.08);
      border: 1px solid rgba(59, 130, 246, 0.15);
      border-radius: 10px;
    }

    .use-case-title {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--accent);
      margin-bottom: 6px;
    }

    .use-case-text {
      font-size: 0.78rem;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .code-example {
      margin-top: 8px;
      padding: 8px 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      font-family: ui-monospace, monospace;
      font-size: 0.72rem;
      color: #a5b4fc;
      overflow-x: auto;
    }

    .dot-indicator {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      flex-shrink: 0;
    }

    .dot-indicator.ok { background: var(--success); box-shadow: 0 0 6px rgba(34, 197, 94, 0.5); }
    .dot-indicator.no { background: var(--danger); box-shadow: 0 0 6px rgba(239, 68, 68, 0.5); }
    .dot-indicator.maybe { background: var(--warning); box-shadow: 0 0 6px rgba(234, 179, 8, 0.5); }

    /* ===== Environment Grid ===== */
    .env-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .env-item {
      display: flex;
      flex-direction: column;
      gap: 3px;
      padding: 10px 12px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.06);
    }

    .env-label {
      font-size: 0.66rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
    }

    .env-value {
      font-size: 0.82rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* ===== Summary Stats ===== */
    .summary-stats {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .stat-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px 18px;
      background: rgba(15, 23, 42, 0.6);
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.08);
      min-width: 75px;
    }

    .stat-number {
      font-size: 1.4rem;
      font-weight: 600;
    }

    .stat-number.green { color: var(--success); }
    .stat-number.red { color: var(--danger); }
    .stat-number.yellow { color: var(--warning); }

    .stat-label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    /* ===== Log / JSON Output ===== */
    .log-container {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .log-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .log-header span {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .log {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
      font-size: 0.76rem;
      background: rgba(15, 23, 42, 0.95);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(30, 64, 175, 0.5);
      padding: 10px 12px;
      max-height: 350px;
      overflow: auto;
      white-space: pre;
      color: #d1d5db;
      line-height: 1.5;
    }

    /* ===== Hints Section Specific ===== */
    .hint-selector {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .hint-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .hint-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.12s ease-out;
    }

    .hint-option:hover {
      border-color: rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.8);
    }

    .hint-option.selected {
      border-color: var(--accent);
      background: rgba(59, 130, 246, 0.15);
    }

    .hint-option input {
      display: none;
    }

    .hint-checkbox {
      width: 18px;
      height: 18px;
      border-radius: 5px;
      border: 2px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.1s ease-out;
      font-size: 11px;
      color: transparent;
    }

    .hint-option.selected .hint-checkbox {
      border-color: var(--accent);
      background: var(--accent);
      color: white;
    }

    .hint-label {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .hint-label-name {
      font-size: 0.85rem;
      font-weight: 500;
    }

    .hint-label-desc {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .hint-result {
      margin-top: 8px;
      padding: 14px 16px;
      background: rgba(15, 23, 42, 0.7);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.1);
    }

    .hint-result-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .hint-result-content {
      font-size: 0.85rem;
      line-height: 1.6;
    }

    .hint-code {
      display: inline-block;
      padding: 2px 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 6px;
      font-family: ui-monospace, monospace;
      font-size: 0.8rem;
      color: var(--accent);
    }

    /* ===== Info Box ===== */
    .info-box {
      padding: 14px 16px;
      background: rgba(59, 130, 246, 0.08);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: var(--radius-lg);
      font-size: 0.8rem;
      color: var(--text-muted);
      line-height: 1.55;
    }

    .info-box strong {
      color: var(--text-main);
    }

    .info-box code {
      padding: 1px 6px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      font-family: ui-monospace, monospace;
      font-size: 0.78rem;
    }

    /* ===== Footer ===== */
    footer {
      margin-top: 8px;
      font-size: 0.75rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
    }

    .footer-link {
      color: var(--accent);
      text-decoration: none;
      opacity: 0.75;
    }

    .footer-link:hover {
      opacity: 1;
      text-decoration: underline;
    }

    /* ===== Animations ===== */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .check-item.animated {
      animation: fadeIn 0.25s ease-out forwards;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .loading {
      animation: pulse 1.2s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- ===== Header ===== -->
    <header>
      <div class="title-block">
        <h1>
          <span class="logo">üîê</span>
          WebAuthn Explorer
        </h1>
        <p class="subtitle">
          Understand and test WebAuthn Level 3 features on your device. Learn what capabilities your browser supports for passkeys and passwordless authentication.
        </p>
      </div>
      <div class="header-meta">
        <span id="envPill" class="pill">
          <span class="pill-dot"></span>
          <span id="envText">Detecting‚Ä¶</span>
        </span>
        <span id="browserPill" class="browser-pill"></span>
      </div>
    </header>

    <!-- ===== Navigation Tabs ===== -->
    <nav class="nav-tabs">
      <button class="nav-tab active" data-section="capabilities">
        <span class="nav-tab-icon">üìã</span>
        <span>Client Capabilities</span>
        <span class="nav-tab-badge">L3</span>
      </button>
      <button class="nav-tab" data-section="hints">
        <span class="nav-tab-icon">üéØ</span>
        <span>Authenticator Hints</span>
        <span class="nav-tab-badge">L3</span>
      </button>
      <button class="nav-tab" data-section="extensions">
        <span class="nav-tab-icon">üß©</span>
        <span>Extensions</span>
      </button>
    </nav>

    <!-- ===== Main Content ===== -->
    <main>
      <!-- ========== Section: Client Capabilities ========== -->
      <section id="section-capabilities" class="check-section active">
        <div class="section-header">
          <div class="section-title-block">
            <h2>
              <span>üìã</span>
              Client Capabilities
            </h2>
            <p>
              Query <code>PublicKeyCredential.getClientCapabilities()</code> to discover what WebAuthn features this browser/device supports.
            </p>
          </div>
          <div class="section-actions">
            <button id="runCapabilitiesBtn" class="primary">
              <span>‚ñ∂</span>
              <span>Run Check</span>
            </button>
            <button id="copyCapabilitiesBtn" class="secondary" disabled>
              <span>‚ßâ</span>
              <span>Copy JSON</span>
            </button>
          </div>
        </div>

        <div class="card-grid">
          <!-- Left: Dashboard -->
          <div class="card">
        <div class="card-inner">
          <div class="card-header">
            <div>
              <div class="card-title">Dashboard</div>
                  <div class="card-subtitle">Interpreted capability results</div>
              </div>
                <div id="capStatusBadge" class="badge warn">
              <span class="badge-dot"></span>
                  <span id="capStatusText">Not tested</span>
            </div>
          </div>

              <!-- Summary Stats -->
              <div id="capSummaryStats" class="summary-stats" style="display: none;">
                <div class="stat-box">
                  <span id="capStatSupported" class="stat-number green">0</span>
                  <span class="stat-label">Supported</span>
                </div>
                <div class="stat-box">
                  <span id="capStatUnsupported" class="stat-number red">0</span>
                  <span class="stat-label">Unsupported</span>
                </div>
                <div class="stat-box">
                  <span id="capStatUnknown" class="stat-number yellow">0</span>
                  <span class="stat-label">Unknown</span>
                </div>
              </div>

              <!-- Environment -->
          <div>
                <div class="section-label">Environment</div>
                <div class="env-grid">
                  <div class="env-item">
                    <div class="env-label">PublicKeyCredential</div>
                    <div class="env-value">
                      <span id="pkcIndicator" class="dot-indicator maybe"></span>
                  <span id="pkcText">Checking‚Ä¶</span>
                </div>
              </div>
                  <div class="env-item">
                    <div class="env-label">getClientCapabilities()</div>
                    <div class="env-value">
                      <span id="gccIndicator" class="dot-indicator maybe"></span>
                  <span id="gccText">Checking‚Ä¶</span>
                </div>
              </div>
                  <div class="env-item">
                    <div class="env-label">Legacy UVPAA</div>
                    <div class="env-value">
                      <span id="uvpaaIndicator" class="dot-indicator maybe"></span>
                      <span id="uvpaaText">Checking‚Ä¶</span>
                </div>
              </div>
                  <div class="env-item">
                    <div class="env-label">Conditional UI</div>
                    <div class="env-value">
                      <span id="conditionalIndicator" class="dot-indicator maybe"></span>
                      <span id="conditionalText">Checking‚Ä¶</span>
                </div>
              </div>
            </div>
          </div>

              <!-- Capabilities List -->
          <div>
                <div class="section-label">Detected Capabilities</div>
                <div id="capabilitiesList" class="check-list">
                  <div class="check-item" style="opacity: 0.5;">
                    <div class="check-item-description">
                      Click "Run Check" to detect capabilities on this device.
                </div>
              </div>
                </div>
              </div>
                </div>
              </div>

          <!-- Right: Raw JSON -->
          <div class="card">
            <div class="card-inner">
              <div class="card-header">
                <div>
                  <div class="card-title">Raw JSON Output</div>
                  <div class="card-subtitle">Direct API response</div>
                </div>
              </div>
              <div class="log-container">
                <div class="log-header">
                  <span id="capLogLabel">Result appears after running check</span>
                  <span id="capLogMeta"></span>
                </div>
                <div id="capLog" class="log">{"info": "Click 'Run Check' to begin"}</div>
              </div>
                </div>
              </div>
        </div>
      </section>

      <!-- ========== Section: Authenticator Hints ========== -->
      <section id="section-hints" class="check-section">
        <div class="section-header">
          <div class="section-title-block">
            <h2>
              <span>üéØ</span>
              Authenticator Hints
            </h2>
            <p>
              Test the <code>hints</code> parameter (<code>PublicKeyCredentialHints</code>) which guides the browser on which type of authenticator to prefer during registration or authentication.
            </p>
            </div>
          </div>

        <div class="card-grid">
          <!-- Left: Hint Selector & Explanation -->
          <div class="card">
            <div class="card-inner">
              <div class="card-header">
                <div>
                  <div class="card-title">Hint Selection</div>
                  <div class="card-subtitle">Choose hints to include in your WebAuthn request</div>
        </div>
              </div>

              <div class="info-box">
                <strong>What are Hints?</strong><br>
                The <code>hints</code> property is an array of strings that suggest to the browser which authenticator type the relying party prefers. Hints are <strong>non-binding</strong> ‚Äî the browser may ignore them based on user preferences or available authenticators.
              </div>

              <div class="hint-selector">
                <div class="section-label">Available Hints (WebAuthn L3)</div>
                <div class="hint-options" id="hintOptions">
                  <label class="hint-option" data-hint="security-key">
                    <input type="checkbox" name="hint" value="security-key">
                    <span class="hint-checkbox">‚úì</span>
                    <div class="hint-label">
                      <span class="hint-label-name">üîë security-key</span>
                      <span class="hint-label-desc">Prefer roaming security keys (USB, NFC, BLE)</span>
                    </div>
                  </label>
                  <label class="hint-option" data-hint="client-device">
                    <input type="checkbox" name="hint" value="client-device">
                    <span class="hint-checkbox">‚úì</span>
                    <div class="hint-label">
                      <span class="hint-label-name">üíª client-device</span>
                      <span class="hint-label-desc">Prefer this device's built-in authenticator</span>
                    </div>
                  </label>
                  <label class="hint-option" data-hint="hybrid">
                    <input type="checkbox" name="hint" value="hybrid">
                    <span class="hint-checkbox">‚úì</span>
                    <div class="hint-label">
                      <span class="hint-label-name">üì± hybrid</span>
                      <span class="hint-label-desc">Prefer phone/tablet as authenticator (QR + BLE)</span>
                    </div>
                  </label>
                </div>
              </div>

              <div class="hint-result" id="hintResult">
                <div class="hint-result-title">Generated Options Object</div>
                <div class="hint-result-content">
                  <p style="margin: 0 0 8px; color: var(--text-muted); font-size: 0.78rem;">
                    This shows how the <code>hints</code> array would appear in your WebAuthn options:
                  </p>
                  <code id="hintCode" class="hint-code">hints: []</code>
                </div>
              </div>

              <div class="section-actions" style="margin-top: 8px;">
                <button id="testHintsCreateBtn" class="primary">
                  <span>‚ú®</span>
                  <span>Test with Create</span>
                </button>
                <button id="testHintsGetBtn" class="secondary">
                  <span>üîì</span>
                  <span>Test with Get</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Right: Explanation & Browser Support -->
          <div class="card">
        <div class="card-inner">
          <div class="card-header">
            <div>
                  <div class="card-title">Understanding Hints</div>
                  <div class="card-subtitle">How browsers interpret authenticator hints</div>
              </div>
              </div>

              <div class="check-list" id="hintsExplanationList">
                <!-- security-key -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üîë security-key</span>
                    </span>
                  </div>
                  <div class="check-item-summary">
                    Suggests the relying party prefers a <strong>roaming authenticator</strong> like a USB security key, NFC token, or Bluetooth device.
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Hardware-backed security</div>
                        <div class="detail-explanation">‚Ä¶credentials live on a physical device that can't be remotely compromised.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Device-bound, non-syncable</div>
                        <div class="detail-explanation">‚Ä¶the private key never leaves the security key hardware.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Portable across devices</div>
                        <div class="detail-explanation">‚Ä¶plug the same key into any computer to authenticate.</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">High-security environments where you need phishing-resistant, hardware-bound credentials. Common for enterprise SSO, admin accounts, or compliance requirements (NIST, PCI-DSS).</div>
                    </div>
                    <div class="code-example">hints: ["security-key"]</div>
            </div>
          </div>

                <!-- client-device -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üíª client-device</span>
                    </span>
          </div>
                  <div class="check-item-summary">
                    Suggests the relying party prefers the <strong>platform authenticator</strong> built into the current device ‚Äî Touch ID, Face ID, Windows Hello.
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Zero friction authentication</div>
                        <div class="detail-explanation">‚Ä¶users tap their finger or glance at the camera ‚Äî done.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">No external hardware needed</div>
                        <div class="detail-explanation">‚Ä¶works with what's already built into the device.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">May sync across devices</div>
                        <div class="detail-explanation">‚Ä¶depending on platform (iCloud Keychain, Google Password Manager).</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">Consumer apps prioritizing ease of use. Best for returning users on trusted personal devices where you want the fastest possible login experience.</div>
                    </div>
                    <div class="code-example">hints: ["client-device"]</div>
                  </div>
                </div>

                <!-- hybrid -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üì± hybrid</span>
                    </span>
                  </div>
                  <div class="check-item-summary">
                    Suggests the relying party prefers <strong>cross-device authentication</strong> using a phone as the authenticator via QR code + Bluetooth.
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Desktop shows QR code</div>
                        <div class="detail-explanation">‚Ä¶user scans it with their phone's camera.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Authenticate on your phone</div>
                        <div class="detail-explanation">‚Ä¶using Face ID, Touch ID, or fingerprint on the mobile device.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Bluetooth verifies proximity</div>
                        <div class="detail-explanation">‚Ä¶ensures the phone is physically nearby (anti-phishing protection).</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">Shared computers, public terminals, or devices without biometrics. Perfect for library computers, hotel business centers, or when users are on someone else's machine.</div>
                    </div>
                    <div class="code-example">hints: ["hybrid"]</div>
                  </div>
                </div>
              </div>

              <div class="info-box" style="margin-top: 12px;">
                <strong>‚ö†Ô∏è Hints are Non-Binding</strong><br>
                The browser may ignore hints based on user preferences, available authenticators, or platform policies. Hints guide the UI ‚Äî they don't restrict options.
              </div>

              <div class="info-box" style="margin-top: 8px;">
                <strong>üìã Ordering Matters</strong><br>
                Hints are processed in array order. The first hint is the strongest preference. Example: <code>["client-device", "hybrid"]</code> means "prefer platform authenticator, but offer phone-as-key as fallback."
              </div>

              <div id="hintTestResult" class="hint-result" style="display: none; margin-top: 12px;">
                <div class="hint-result-title">Test Result</div>
                <div class="hint-result-content" id="hintTestResultContent"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ========== Section: WebAuthn Extensions ========== -->
      <section id="section-extensions" class="check-section">
        <div class="section-header">
          <div class="section-title-block">
            <h2>
              <span>üß©</span>
              WebAuthn Extensions
            </h2>
            <p>
              Extensions add optional functionality to WebAuthn operations. Specify them in the <code>extensions</code> property of your create/get options.
            </p>
          </div>
        </div>

        <div class="card-grid">
          <!-- Left: Core Extensions -->
          <div class="card">
        <div class="card-inner">
          <div class="card-header">
            <div>
                  <div class="card-title">Core Extensions</div>
                  <div class="card-subtitle">Commonly used extensions for passkey implementations</div>
              </div>
              </div>

              <div class="check-list" id="coreExtensionsList">
                <!-- credProps -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üìù credProps</span>
                    </span>
                  </div>
                  <div class="check-item-summary">
                    Get information about the credential that was just created, including whether it's <strong>discoverable</strong> (resident).
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Know if credential is discoverable</div>
                        <div class="detail-explanation">‚Ä¶the rk (resident key) property tells you if it's stored on the authenticator.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Verify authenticator compliance</div>
                        <div class="detail-explanation">‚Ä¶confirm the authenticator respected your residentKey preference.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Adjust your UX accordingly</div>
                        <div class="detail-explanation">‚Ä¶show different flows for discoverable vs. server-side credentials.</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">Essential when you request residentKey: 'preferred'. The authenticator might not support it, so credProps tells you what actually happened.</div>
                    </div>
                    <div class="code-example">extensions: { credProps: true }
// Response: { rk: true }</div>
            </div>
          </div>

                <!-- largeBlob -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üíæ largeBlob</span>
                    </span>
          </div>
                  <div class="check-item-summary">
                    Store and retrieve arbitrary data (up to ~4KB) alongside a credential on the authenticator.
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Store data with the credential</div>
                        <div class="detail-explanation">‚Ä¶like encryption keys, certificates, or user preferences.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Data travels with the credential</div>
                        <div class="detail-explanation">‚Ä¶if passkeys sync, the blob syncs too.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Read data during authentication</div>
                        <div class="detail-explanation">‚Ä¶retrieve the blob when the user signs in.</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">Advanced use case: store a wrapped encryption key so users can decrypt data on any device where their passkey syncs. Also useful for offline-first apps.</div>
                    </div>
                    <div class="code-example">// Write
extensions: { largeBlob: { write: new Uint8Array([...]) } }
// Read
extensions: { largeBlob: { read: true } }</div>
                  </div>
                </div>

                <!-- PRF -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üé≤ prf (Pseudo-Random Function)</span>
                    </span>
                  </div>
                  <div class="check-item-summary">
                    Derive deterministic secret keys from a credential ‚Äî the same input always produces the same output.
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Generate encryption keys</div>
                        <div class="detail-explanation">‚Ä¶derive keys for encrypting user data client-side.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Deterministic output</div>
                        <div class="detail-explanation">‚Ä¶same credential + same input = same derived key, every time.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">No server storage needed</div>
                        <div class="detail-explanation">‚Ä¶the key is derived on-demand, never stored.</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">End-to-end encryption without key escrow. Derive encryption keys from the passkey itself ‚Äî if the passkey syncs, the encryption capability follows.</div>
                    </div>
                    <div class="code-example">extensions: {
  prf: { eval: { first: new Uint8Array(32) } }
}</div>
                  </div>
                </div>

                <!-- devicePubKey -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üîê devicePubKey</span>
                    </span>
                  </div>
                  <div class="check-item-summary">
                    Get a device-bound key in addition to the credential, enabling device binding for synced passkeys.
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Separate device-bound key</div>
                        <div class="detail-explanation">‚Ä¶doesn't sync, stays on this specific device.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Detect new devices</div>
                        <div class="detail-explanation">‚Ä¶know when a synced passkey is used from a new device.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Step-up authentication trigger</div>
                        <div class="detail-explanation">‚Ä¶prompt additional verification for unknown devices.</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">Banks and high-security apps: even with synced passkeys, detect when authentication comes from a new device and trigger additional verification.</div>
                    </div>
                    <div class="code-example">extensions: { devicePubKey: { attestation: "direct" } }</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right: Security & Compatibility Extensions -->
          <div class="card">
            <div class="card-inner">
              <div class="card-header">
                <div>
                  <div class="card-title">Security & Compatibility</div>
                  <div class="card-subtitle">Extensions for security policies and legacy support</div>
                </div>
              </div>

              <div class="check-list">
                <!-- credProtect -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üõ°Ô∏è credProtect</span>
                    </span>
                  </div>
                  <div class="check-item-summary">
                    Control when and how a credential can be used ‚Äî restrict to user verification or specific use cases.
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">1Ô∏è‚É£</span>
                      <div class="detail-content">
                        <div class="detail-title">Level 1: userVerificationOptional</div>
                        <div class="detail-explanation">‚Ä¶credential usable with or without UV (default).</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">2Ô∏è‚É£</span>
                      <div class="detail-content">
                        <div class="detail-title">Level 2: userVerificationOptionalWithCredentialIDList</div>
                        <div class="detail-explanation">‚Ä¶discoverable only if credential ID is provided.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">3Ô∏è‚É£</span>
                      <div class="detail-content">
                        <div class="detail-title">Level 3: userVerificationRequired</div>
                        <div class="detail-explanation">‚Ä¶credential ONLY works with user verification.</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">High-security scenarios where you want to ensure the credential can't be used without biometric/PIN verification, even if the RP doesn't request it.</div>
                    </div>
                    <div class="code-example">extensions: {
  credentialProtectionPolicy: "userVerificationRequired",
  enforceCredentialProtectionPolicy: true
}</div>
                  </div>
                </div>

                <!-- minPinLength -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üî¢ minPinLength</span>
                    </span>
                  </div>
                  <div class="check-item-summary">
                    Request authenticators enforce a minimum PIN length for added security.
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Enforce PIN complexity</div>
                        <div class="detail-explanation">‚Ä¶require PINs of at least N characters.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Query current PIN length policy</div>
                        <div class="detail-explanation">‚Ä¶check what minimum the authenticator currently enforces.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Meet compliance requirements</div>
                        <div class="detail-explanation">‚Ä¶satisfy enterprise security policies.</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">Enterprise deployments where security policies require PINs of a certain length. Useful for FIDO2 security key rollouts.</div>
                    </div>
                    <div class="code-example">extensions: { minPinLength: true }</div>
                  </div>
                </div>

                <!-- uvm -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üîç uvm (User Verification Method)</span>
                    </span>
                  </div>
                  <div class="check-item-summary">
                    Learn which method the user used to verify their identity ‚Äî fingerprint, face, PIN, etc.
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Know how the user authenticated</div>
                        <div class="detail-explanation">‚Ä¶fingerprint, face recognition, PIN, or presence.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Audit and compliance logging</div>
                        <div class="detail-explanation">‚Ä¶record the verification method for security audits.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Adaptive security decisions</div>
                        <div class="detail-explanation">‚Ä¶require stronger UV for sensitive operations.</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">Security auditing and compliance. Know if the user used a biometric (stronger) vs. PIN (weaker) so you can make risk-based decisions.</div>
                    </div>
                    <div class="code-example">extensions: { uvm: true }
// Response: [[0x02, 0x04, 0x02]] ‚Üí fingerprint</div>
                  </div>
                </div>

                <!-- appid -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üîÑ appid (U2F Compatibility)</span>
                    </span>
                  </div>
                  <div class="check-item-summary">
                    Allow WebAuthn to authenticate with credentials originally registered via the legacy U2F API.
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Migrate from U2F to WebAuthn</div>
                        <div class="detail-explanation">‚Ä¶existing U2F credentials keep working.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Specify the original App ID</div>
                        <div class="detail-explanation">‚Ä¶the U2F appId used during registration.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Gradual migration path</div>
                        <div class="detail-explanation">‚Ä¶no need to re-register all users at once.</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">If you previously used U2F (chrome.runtime.sendMessage or the u2f-api.js polyfill), use appid to let those old credentials work with WebAuthn.</div>
                    </div>
                    <div class="code-example">extensions: { appid: "https://example.com" }</div>
                  </div>
                </div>

                <!-- SPC -->
                <div class="check-item">
                  <div class="check-item-header">
                    <span class="check-item-name">
                      <span class="dot-indicator ok"></span>
                      <span>üí≥ Secure Payment Confirmation</span>
                    </span>
                  </div>
                  <div class="check-item-summary">
                    Streamlined payment authentication that shows transaction details in the WebAuthn prompt.
                  </div>
                  <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
                    <span>‚ñ∂</span>
                    <span class="toggle-text">Learn more</span>
                    <span class="toggle-text-collapse">Show less</span>
                  </div>
                  <div class="check-item-details">
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Display transaction details</div>
                        <div class="detail-explanation">‚Ä¶amount, merchant, currency shown in browser UI.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">User confirms with biometric</div>
                        <div class="detail-explanation">‚Ä¶one gesture to authenticate and confirm payment.</div>
                      </div>
                    </div>
                    <div class="detail-point">
                      <span class="detail-icon">‚úî</span>
                      <div class="detail-content">
                        <div class="detail-title">Cryptographic proof of consent</div>
                        <div class="detail-explanation">‚Ä¶the signature covers the transaction details.</div>
                      </div>
                    </div>
                    <div class="use-case-box">
                      <div class="use-case-title">üí° When to use</div>
                      <div class="use-case-text">Online checkout flows. Replace SMS OTP or card CVV with a single biometric confirmation that proves the user saw and approved the exact transaction.</div>
                    </div>
                    <div class="code-example">const payment = new PaymentRequest([{
  supportedMethods: "secure-payment-confirmation",
  data: { credentialIds, challenge, ... }
}], details);</div>
                  </div>
                </div>
              </div>

              <div class="info-box" style="margin-top: 12px;">
                <strong>üìö Extension Support Varies</strong><br>
                Not all authenticators or browsers support all extensions. Always check the extension output in the response to confirm your request was honored. Use feature detection when available.
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- ===== Footer ===== -->
    <footer>
      <div>üí° Compare results across browsers/devices to understand passkey support differences.</div>
      <div>
        <a class="footer-link" href="https://www.w3.org/TR/webauthn-3/" target="_blank" rel="noreferrer">
          WebAuthn Level 3 Spec ‚Üó
        </a>
        &nbsp;¬∑&nbsp;
        <a class="footer-link" href="https://passkeys.dev" target="_blank" rel="noreferrer">
          passkeys.dev ‚Üó
        </a>
      </div>
    </footer>
  </div>

  <script>
    // =========================================================================
    // Element References
    // =========================================================================
    const envPill = document.getElementById("envPill");
    const envText = document.getElementById("envText");
    const browserPill = document.getElementById("browserPill");

    // Capabilities Section
    const runCapabilitiesBtn = document.getElementById("runCapabilitiesBtn");
    const copyCapabilitiesBtn = document.getElementById("copyCapabilitiesBtn");
    const capStatusBadge = document.getElementById("capStatusBadge");
    const capStatusText = document.getElementById("capStatusText");
    const capSummaryStats = document.getElementById("capSummaryStats");
    const capStatSupported = document.getElementById("capStatSupported");
    const capStatUnsupported = document.getElementById("capStatUnsupported");
    const capStatUnknown = document.getElementById("capStatUnknown");
    const capabilitiesList = document.getElementById("capabilitiesList");
    const capLog = document.getElementById("capLog");
    const capLogLabel = document.getElementById("capLogLabel");
    const capLogMeta = document.getElementById("capLogMeta");

    const pkcIndicator = document.getElementById("pkcIndicator");
    const pkcText = document.getElementById("pkcText");
    const gccIndicator = document.getElementById("gccIndicator");
    const gccText = document.getElementById("gccText");
    const uvpaaIndicator = document.getElementById("uvpaaIndicator");
    const uvpaaText = document.getElementById("uvpaaText");
    const conditionalIndicator = document.getElementById("conditionalIndicator");
    const conditionalText = document.getElementById("conditionalText");

    // Hints Section
    const hintOptions = document.getElementById("hintOptions");
    const hintCode = document.getElementById("hintCode");
    const testHintsCreateBtn = document.getElementById("testHintsCreateBtn");
    const testHintsGetBtn = document.getElementById("testHintsGetBtn");
    const hintTestResult = document.getElementById("hintTestResult");
    const hintTestResultContent = document.getElementById("hintTestResultContent");

    // =========================================================================
    // Capability Definitions (WebAuthn L3) - Rich Educational Content
    // =========================================================================
    const CAPABILITY_INFO = {
      conditionalCreate: {
        name: "Conditional Create",
        icon: "‚ú®",
        summary: "Allows websites to prepare passkey creation without immediately triggering browser UI, waiting for a real user gesture.",
        details: [
          {
            icon: "‚úî",
            title: "Check whether the device can create passkeys",
            explanation: "‚Ä¶without triggering a popup or system UI."
          },
          {
            icon: "‚úî",
            title: "Prepare all the WebAuthn parameters",
            explanation: "‚Ä¶so everything is ready behind the scenes."
          },
          {
            icon: "‚úî",
            title: "Wait for a real user gesture",
            explanation: "‚Ä¶like clicking \"Create account\" or \"Save passkey\"."
          }
        ],
        useCase: "Perfect for onboarding flows where you want to check passkey availability first, then prompt the user at the right moment ‚Äî not immediately on page load.",
        codeExample: "mediation: \"conditional\""
      },
      conditionalGet: {
        name: "Conditional Get (Autofill)",
        icon: "üîë",
        summary: "Enables passkeys to appear in the browser's autofill suggestions, just like saved passwords.",
        details: [
          {
            icon: "‚úî",
            title: "Passkeys appear in autofill dropdown",
            explanation: "‚Ä¶alongside saved passwords when user focuses a login field."
          },
          {
            icon: "‚úî",
            title: "No modal popup required",
            explanation: "‚Ä¶the authentication flow feels native and non-intrusive."
          },
          {
            icon: "‚úî",
            title: "User selects which passkey to use",
            explanation: "‚Ä¶from a familiar UI they already know from password autofill."
          }
        ],
        useCase: "The key to seamless passkey adoption. Users can authenticate with a single tap from the autofill menu, making passkeys feel as easy as saved passwords.",
        codeExample: "mediation: \"conditional\", autocomplete: \"username webauthn\""
      },
      hybridTransport: {
        name: "Hybrid Transport",
        icon: "üì±",
        summary: "Use your phone or tablet as an authenticator for another device via QR code and Bluetooth.",
        details: [
          {
            icon: "‚úî",
            title: "Scan a QR code on the desktop",
            explanation: "‚Ä¶to initiate cross-device authentication."
          },
          {
            icon: "‚úî",
            title: "Authenticate on your phone",
            explanation: "‚Ä¶using Face ID, Touch ID, or fingerprint."
          },
          {
            icon: "‚úî",
            title: "Bluetooth verifies proximity",
            explanation: "‚Ä¶ensuring the phone is physically nearby for security."
          }
        ],
        useCase: "Essential for users on shared/public computers or when the current device lacks biometrics. Your phone becomes a portable authenticator.",
        codeExample: "transports: [\"hybrid\"]"
      },
      passkeyPlatformAuthenticator: {
        name: "Passkey Platform Authenticator",
        icon: "‚òÅÔ∏è",
        summary: "Supports synced passkeys that automatically sync across your devices via cloud (iCloud Keychain, Google Password Manager, etc.).",
        details: [
          {
            icon: "‚úî",
            title: "Create a passkey on one device",
            explanation: "‚Ä¶and it automatically syncs to your other devices."
          },
          {
            icon: "‚úî",
            title: "Lost device? No problem",
            explanation: "‚Ä¶your passkeys are backed up and recoverable."
          },
          {
            icon: "‚úî",
            title: "Works across the ecosystem",
            explanation: "‚Ä¶iPhone ‚Üî iPad ‚Üî Mac, or Android ‚Üî Chrome on any device."
          }
        ],
        useCase: "The modern passkey experience. Users don't lose access when they get a new phone ‚Äî their passkeys follow them automatically.",
        codeExample: "residentKey: \"required\", authenticatorAttachment: \"platform\""
      },
      userVerifyingPlatformAuthenticator: {
        name: "User Verifying Platform Authenticator",
        icon: "üëÜ",
        summary: "The device has built-in biometrics or PIN for user verification (Face ID, Touch ID, Windows Hello, fingerprint).",
        details: [
          {
            icon: "‚úî",
            title: "Biometric authentication available",
            explanation: "‚Ä¶like Face ID, Touch ID, or fingerprint sensor."
          },
          {
            icon: "‚úî",
            title: "Fallback to device PIN/password",
            explanation: "‚Ä¶when biometrics aren't available or fail."
          },
          {
            icon: "‚úî",
            title: "No external hardware required",
            explanation: "‚Ä¶authentication happens entirely on this device."
          }
        ],
        useCase: "The foundation for passkeys on modern devices. This is the legacy API that tells you if the device can do passwordless auth locally.",
        codeExample: "PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()"
      },
      relatedOrigins: {
        name: "Related Origins",
        icon: "üîó",
        summary: "Use passkeys across related domains (e.g., example.com and app.example.com) without re-registration.",
        details: [
          {
            icon: "‚úî",
            title: "Share credentials across subdomains",
            explanation: "‚Ä¶and even across related domain names."
          },
          {
            icon: "‚úî",
            title: "Configure via .well-known file",
            explanation: "‚Ä¶with a JSON file listing allowed origins."
          },
          {
            icon: "‚úî",
            title: "Seamless multi-domain experience",
            explanation: "‚Ä¶users authenticate once, use everywhere."
          }
        ],
        useCase: "Perfect for enterprises with multiple domains or apps that span web and native platforms but want unified authentication.",
        codeExample: "/.well-known/webauthn ‚Üí { \"origins\": [\"https://app.example.com\"] }"
      },
      signalAllAcceptedCredentials: {
        name: "Signal All Accepted Credentials",
        icon: "üìã",
        summary: "Tell the authenticator which credentials your server actually accepts, so it can clean up stale entries.",
        details: [
          {
            icon: "‚úî",
            title: "Server sends list of valid credential IDs",
            explanation: "‚Ä¶so the authenticator knows what's still active."
          },
          {
            icon: "‚úî",
            title: "Authenticator can hide/remove old credentials",
            explanation: "‚Ä¶keeping the user's credential list clean."
          },
          {
            icon: "‚úî",
            title: "Prevents confusion from stale passkeys",
            explanation: "‚Ä¶users only see credentials that will actually work."
          }
        ],
        useCase: "Crucial for good UX. When users delete their account or you rotate credentials server-side, this lets their device know.",
        codeExample: "PublicKeyCredential.signalAllAcceptedCredentials({...})"
      },
      signalCurrentUserDetails: {
        name: "Signal Current User Details",
        icon: "üë§",
        summary: "Update the display name and user info stored with a passkey without re-registering.",
        details: [
          {
            icon: "‚úî",
            title: "User changes their display name",
            explanation: "‚Ä¶update it on the passkey without re-enrollment."
          },
          {
            icon: "‚úî",
            title: "Fix typos or outdated info",
            explanation: "‚Ä¶the passkey's metadata stays current."
          },
          {
            icon: "‚úî",
            title: "Better credential picker UX",
            explanation: "‚Ä¶users see accurate, recognizable names."
          }
        ],
        useCase: "When a user updates their profile name or email, you can push that change to their stored passkey so it displays correctly.",
        codeExample: "PublicKeyCredential.signalCurrentUserDetails({...})"
      },
      signalUnknownCredential: {
        name: "Signal Unknown Credential",
        icon: "‚ùì",
        summary: "Tell the authenticator when a credential it offers is unknown to your server, enabling cleanup.",
        details: [
          {
            icon: "‚úî",
            title: "User tries a deleted passkey",
            explanation: "‚Ä¶your server doesn't recognize it."
          },
          {
            icon: "‚úî",
            title: "Signal back that it's unknown",
            explanation: "‚Ä¶the authenticator can mark or remove it."
          },
          {
            icon: "‚úî",
            title: "Self-healing credential lists",
            explanation: "‚Ä¶stale passkeys automatically get cleaned up."
          }
        ],
        useCase: "Handles the case where a user has a passkey their device remembers, but your server has deleted. Prevents repeated failed attempts.",
        codeExample: "PublicKeyCredential.signalUnknownCredential({...})"
      },

      // =========================================================================
      // WebAuthn Extensions
      // =========================================================================
      
      "extension:credProps": {
        name: "Credential Properties (credProps)",
        icon: "üìù",
        summary: "Get information about the credential that was just created, including whether it's discoverable (resident).",
        details: [
          {
            icon: "‚úî",
            title: "Know if credential is discoverable",
            explanation: "‚Ä¶the rk (resident key) property tells you if it's stored on the authenticator."
          },
          {
            icon: "‚úî",
            title: "Verify authenticator compliance",
            explanation: "‚Ä¶confirm the authenticator respected your residentKey preference."
          },
          {
            icon: "‚úî",
            title: "Adjust your UX accordingly",
            explanation: "‚Ä¶show different flows for discoverable vs. server-side credentials."
          }
        ],
        useCase: "Essential when you request residentKey: 'preferred'. The authenticator might not support it, so credProps tells you what actually happened.",
        codeExample: "extensions: { credProps: true }\n// Response: { rk: true }"
      },

      "extension:largeBlob": {
        name: "Large Blob Storage (largeBlob)",
        icon: "üíæ",
        summary: "Store and retrieve arbitrary data (up to ~4KB) alongside a credential on the authenticator.",
        details: [
          {
            icon: "‚úî",
            title: "Store data with the credential",
            explanation: "‚Ä¶like encryption keys, certificates, or user preferences."
          },
          {
            icon: "‚úî",
            title: "Data travels with the credential",
            explanation: "‚Ä¶if passkeys sync, the blob syncs too."
          },
          {
            icon: "‚úî",
            title: "Read data during authentication",
            explanation: "‚Ä¶retrieve the blob when the user signs in."
          }
        ],
        useCase: "Advanced use case: store a wrapped encryption key so users can decrypt data on any device where their passkey syncs. Also useful for offline-first apps.",
        codeExample: "extensions: { largeBlob: { write: new Uint8Array([...]) } }\n// Or read: { largeBlob: { read: true } }"
      },

      "extension:prf": {
        name: "Pseudo-Random Function (PRF)",
        icon: "üé≤",
        summary: "Derive deterministic secret keys from a credential ‚Äî the same input always produces the same output.",
        details: [
          {
            icon: "‚úî",
            title: "Generate encryption keys",
            explanation: "‚Ä¶derive keys for encrypting user data client-side."
          },
          {
            icon: "‚úî",
            title: "Deterministic output",
            explanation: "‚Ä¶same credential + same input = same derived key, every time."
          },
          {
            icon: "‚úî",
            title: "No server storage needed",
            explanation: "‚Ä¶the key is derived on-demand, never stored."
          }
        ],
        useCase: "End-to-end encryption without key escrow. Derive encryption keys from the passkey itself ‚Äî if the passkey syncs, the encryption capability follows.",
        codeExample: "extensions: {\n  prf: { eval: { first: new Uint8Array(32) } }\n}"
      },

      "extension:minPinLength": {
        name: "Minimum PIN Length (minPinLength)",
        icon: "üî¢",
        summary: "Request authenticators enforce a minimum PIN length for added security.",
        details: [
          {
            icon: "‚úî",
            title: "Enforce PIN complexity",
            explanation: "‚Ä¶require PINs of at least N characters."
          },
          {
            icon: "‚úî",
            title: "Query current PIN length policy",
            explanation: "‚Ä¶check what minimum the authenticator currently enforces."
          },
          {
            icon: "‚úî",
            title: "Meet compliance requirements",
            explanation: "‚Ä¶satisfy enterprise security policies."
          }
        ],
        useCase: "Enterprise deployments where security policies require PINs of a certain length. Useful for FIDO2 security key rollouts.",
        codeExample: "extensions: { minPinLength: true }"
      },

      "extension:credProtect": {
        name: "Credential Protection (credProtect)",
        icon: "üõ°Ô∏è",
        summary: "Control when and how a credential can be used ‚Äî restrict to user verification or specific use cases.",
        details: [
          {
            icon: "‚úî",
            title: "Level 1: userVerificationOptional",
            explanation: "‚Ä¶credential usable with or without UV (default)."
          },
          {
            icon: "‚úî",
            title: "Level 2: userVerificationOptionalWithCredentialIDList",
            explanation: "‚Ä¶discoverable only if credential ID is provided."
          },
          {
            icon: "‚úî",
            title: "Level 3: userVerificationRequired",
            explanation: "‚Ä¶credential ONLY works with user verification."
          }
        ],
        useCase: "High-security scenarios where you want to ensure the credential can't be used without biometric/PIN verification, even if the RP doesn't request it.",
        codeExample: "extensions: {\n  credentialProtectionPolicy: \"userVerificationRequired\",\n  enforceCredentialProtectionPolicy: true\n}"
      },

      "extension:appid": {
        name: "App ID (U2F Compatibility)",
        icon: "üîÑ",
        summary: "Allow WebAuthn to authenticate with credentials originally registered via the legacy U2F API.",
        details: [
          {
            icon: "‚úî",
            title: "Migrate from U2F to WebAuthn",
            explanation: "‚Ä¶existing U2F credentials keep working."
          },
          {
            icon: "‚úî",
            title: "Specify the original App ID",
            explanation: "‚Ä¶the U2F appId used during registration."
          },
          {
            icon: "‚úî",
            title: "Gradual migration path",
            explanation: "‚Ä¶no need to re-register all users at once."
          }
        ],
        useCase: "If you previously used U2F (chrome.runtime.sendMessage or the u2f-api.js polyfill), use appid to let those old credentials work with WebAuthn.",
        codeExample: "extensions: { appid: \"https://example.com\" }"
      },

      "extension:appidExclude": {
        name: "App ID Exclude",
        icon: "üö´",
        summary: "Prevent registration if the user already has a U2F credential for the specified App ID.",
        details: [
          {
            icon: "‚úî",
            title: "Check for existing U2F credentials",
            explanation: "‚Ä¶during WebAuthn registration."
          },
          {
            icon: "‚úî",
            title: "Avoid duplicate registrations",
            explanation: "‚Ä¶user can't register same authenticator twice."
          },
          {
            icon: "‚úî",
            title: "Clean migration from U2F",
            explanation: "‚Ä¶prevents confusion during transition."
          }
        ],
        useCase: "During U2F ‚Üí WebAuthn migration, exclude authenticators that already have U2F credentials to prevent duplicate entries.",
        codeExample: "extensions: { appidExclude: \"https://example.com\" }"
      },

      "extension:uvm": {
        name: "User Verification Method (uvm)",
        icon: "üîç",
        summary: "Learn which method the user used to verify their identity ‚Äî fingerprint, face, PIN, etc.",
        details: [
          {
            icon: "‚úî",
            title: "Know how the user authenticated",
            explanation: "‚Ä¶fingerprint, face recognition, PIN, or presence."
          },
          {
            icon: "‚úî",
            title: "Audit and compliance logging",
            explanation: "‚Ä¶record the verification method for security audits."
          },
          {
            icon: "‚úî",
            title: "Adaptive security decisions",
            explanation: "‚Ä¶require stronger UV for sensitive operations."
          }
        ],
        useCase: "Security auditing and compliance. Know if the user used a biometric (stronger) vs. PIN (weaker) so you can make risk-based decisions.",
        codeExample: "extensions: { uvm: true }\n// Response: [[0x02, 0x04, 0x02]] ‚Üí fingerprint"
      },

      "extension:devicePubKey": {
        name: "Device Public Key (devicePubKey)",
        icon: "üîê",
        summary: "Get a device-bound key in addition to the credential, enabling device binding for synced passkeys.",
        details: [
          {
            icon: "‚úî",
            title: "Separate device-bound key",
            explanation: "‚Ä¶doesn't sync, stays on this specific device."
          },
          {
            icon: "‚úî",
            title: "Detect new devices",
            explanation: "‚Ä¶know when a synced passkey is used from a new device."
          },
          {
            icon: "‚úî",
            title: "Step-up authentication trigger",
            explanation: "‚Ä¶prompt additional verification for unknown devices."
          }
        ],
        useCase: "Banks and high-security apps: even with synced passkeys, detect when authentication comes from a new device and trigger additional verification.",
        codeExample: "extensions: { devicePubKey: { attestation: \"direct\" } }"
      },

      "extension:payment": {
        name: "Secure Payment Confirmation (SPC)",
        icon: "üí≥",
        summary: "Streamlined payment authentication that shows transaction details in the WebAuthn prompt.",
        details: [
          {
            icon: "‚úî",
            title: "Display transaction details",
            explanation: "‚Ä¶amount, merchant, currency shown in browser UI."
          },
          {
            icon: "‚úî",
            title: "User confirms with biometric",
            explanation: "‚Ä¶one gesture to authenticate and confirm payment."
          },
          {
            icon: "‚úî",
            title: "Cryptographic proof of consent",
            explanation: "‚Ä¶the signature covers the transaction details."
          }
        ],
        useCase: "Online checkout flows. Replace SMS OTP or card CVV with a single biometric confirmation that proves the user saw and approved the exact transaction.",
        codeExample: "const payment = new PaymentRequest([{\n  supportedMethods: \"secure-payment-confirmation\",\n  data: { credentialIds, challenge, ... }\n}], details);"
      }
    };

    // =========================================================================
    // Utility Functions
    // =========================================================================
    function setDotState(el, state) {
      el.classList.remove("ok", "no", "maybe");
      el.classList.add(state === "ok" ? "ok" : state === "no" ? "no" : "maybe");
    }

    function setBadgeState(badge, textEl, state, text) {
      badge.classList.remove("ok", "warn", "error");
      badge.classList.add(state);
      textEl.textContent = text;
    }

    function detectBrowser() {
      const ua = navigator.userAgent;
      let browser = "Unknown", version = "", os = "Unknown";

      if (ua.includes("Windows")) os = "Windows";
      else if (ua.includes("Mac OS X")) os = "macOS";
      else if (ua.includes("iPhone") || ua.includes("iPad")) os = "iOS";
      else if (ua.includes("Android")) os = "Android";
      else if (ua.includes("Linux")) os = "Linux";
      else if (ua.includes("CrOS")) os = "ChromeOS";

      if (ua.includes("Firefox/")) { browser = "Firefox"; version = ua.match(/Firefox\/(\d+)/)?.[1] || ""; }
      else if (ua.includes("Edg/")) { browser = "Edge"; version = ua.match(/Edg\/(\d+)/)?.[1] || ""; }
      else if (ua.includes("Chrome/")) { browser = "Chrome"; version = ua.match(/Chrome\/(\d+)/)?.[1] || ""; }
      else if (ua.includes("Safari/") && !ua.includes("Chrome")) { browser = "Safari"; version = ua.match(/Version\/(\d+)/)?.[1] || ""; }

      return { browser, version, os, ua };
    }

    // =========================================================================
    // Navigation
    // =========================================================================
    document.querySelectorAll(".nav-tab").forEach(tab => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".nav-tab").forEach(t => t.classList.remove("active"));
        document.querySelectorAll(".check-section").forEach(s => s.classList.remove("active"));
        tab.classList.add("active");
        document.getElementById(`section-${tab.dataset.section}`).classList.add("active");
      });
    });

    // =========================================================================
    // Environment Detection
    // =========================================================================
    async function updateEnvironment() {
      const { browser, version, os } = detectBrowser();
      const hasPKC = typeof PublicKeyCredential !== "undefined";
      const hasGCC = hasPKC && typeof PublicKeyCredential.getClientCapabilities === "function";

      browserPill.textContent = `${browser} ${version} on ${os}`;

      pkcText.textContent = hasPKC ? "Available" : "Not available";
      setDotState(pkcIndicator, hasPKC ? "ok" : "no");

      gccText.textContent = hasGCC ? "Available" : "Not implemented";
      setDotState(gccIndicator, hasGCC ? "ok" : "no");

      if (!hasPKC) {
        envText.textContent = "No WebAuthn";
        envPill.style.borderColor = "#ef4444";
      } else if (!hasGCC) {
        envText.textContent = "WebAuthn OK, L3 partial";
        envPill.style.borderColor = "#eab308";
      } else {
        envText.textContent = "Full L3 Support";
        envPill.style.borderColor = "#22c55e";
      }

      // UVPAA
      if (hasPKC && typeof PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable === "function") {
        try {
          const available = await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
          uvpaaText.textContent = available ? "Available" : "Not available";
            setDotState(uvpaaIndicator, available ? "ok" : "no");
        } catch { uvpaaText.textContent = "Error"; setDotState(uvpaaIndicator, "maybe"); }
      } else {
        uvpaaText.textContent = "Not implemented";
        setDotState(uvpaaIndicator, "no");
      }

      // Conditional UI
      if (hasPKC && typeof PublicKeyCredential.isConditionalMediationAvailable === "function") {
        try {
          const available = await PublicKeyCredential.isConditionalMediationAvailable();
          conditionalText.textContent = available ? "Available" : "Not available";
          setDotState(conditionalIndicator, available ? "ok" : "no");
        } catch { conditionalText.textContent = "Error"; setDotState(conditionalIndicator, "maybe"); }
      } else {
        conditionalText.textContent = "Not implemented";
        setDotState(conditionalIndicator, "no");
      }
    }

    // =========================================================================
    // Capabilities Section
    // =========================================================================
    function renderCapabilities(caps) {
      capabilitiesList.innerHTML = "";
      let supported = 0, unsupported = 0, unknown = 0;

      Object.keys(caps).forEach((key, i) => {
        const value = caps[key];
        const info = CAPABILITY_INFO[key] || { 
          name: key, 
          icon: "üìå",
          summary: `Capability: ${key}`,
          details: [],
          useCase: "",
          codeExample: ""
        };

        if (value === true) supported++;
        else if (value === false) unsupported++;
        else unknown++;

        const item = document.createElement("div");
        item.className = "check-item animated";
        item.style.animationDelay = `${i * 0.04}s`;

        const statusClass = value === true ? "supported" : value === false ? "not-supported" : "unknown";
        const statusLabel = value === true ? "‚úì Supported" : value === false ? "‚úó Not Supported" : "? Unknown";
        const dotClass = value === true ? "ok" : value === false ? "no" : "maybe";

        // Build details HTML
        let detailsHTML = "";
        if (info.details && info.details.length > 0) {
          detailsHTML = info.details.map(d => `
            <div class="detail-point">
              <span class="detail-icon">${d.icon}</span>
              <div class="detail-content">
                <div class="detail-title">${d.title}</div>
                <div class="detail-explanation">${d.explanation}</div>
              </div>
            </div>
          `).join("");
        }

        // Build use case HTML
        let useCaseHTML = "";
        if (info.useCase) {
          useCaseHTML = `
            <div class="use-case-box">
              <div class="use-case-title">üí° When to use</div>
              <div class="use-case-text">${info.useCase}</div>
            </div>
          `;
        }

        // Build code example HTML
        let codeHTML = "";
        if (info.codeExample) {
          codeHTML = `<div class="code-example">${info.codeExample}</div>`;
        }

        item.innerHTML = `
          <div class="check-item-header">
            <span class="check-item-name">
              <span class="dot-indicator ${dotClass}"></span>
              <span>${info.icon || ""} ${info.name}</span>
            </span>
            <span class="check-item-status ${statusClass}">${statusLabel}</span>
          </div>
          <div class="check-item-summary">${info.summary}</div>
          ${(info.details && info.details.length > 0) ? `
            <div class="check-item-toggle" onclick="this.parentElement.classList.toggle('expanded')">
              <span>‚ñ∂</span>
              <span class="toggle-text">Learn more</span>
              <span class="toggle-text-collapse">Show less</span>
            </div>
            <div class="check-item-details">
              ${detailsHTML}
              ${useCaseHTML}
              ${codeHTML}
            </div>
          ` : ''}
        `;
        capabilitiesList.appendChild(item);
      });

      capSummaryStats.style.display = "flex";
      capStatSupported.textContent = supported;
      capStatUnsupported.textContent = unsupported;
      capStatUnknown.textContent = unknown;

      if (Object.keys(caps).length === 0) {
        capabilitiesList.innerHTML = `<div class="check-item" style="opacity:0.6"><div class="check-item-description">Empty capabilities object returned.</div></div>`;
      }
    }

    async function runCapabilitiesCheck() {
      if (typeof PublicKeyCredential === "undefined") {
        setBadgeState(capStatusBadge, capStatusText, "error", "No WebAuthn");
        capLog.textContent = JSON.stringify({ error: "PublicKeyCredential not available" }, null, 2);
        return;
      }

      if (typeof PublicKeyCredential.getClientCapabilities !== "function") {
        setBadgeState(capStatusBadge, capStatusText, "error", "API missing");
        capLog.textContent = JSON.stringify({
          error: "getClientCapabilities() not implemented",
          hint: "Try Chrome 128+, Safari 18+, or recent Edge"
        }, null, 2);
        return;
      }

      runCapabilitiesBtn.disabled = true;
      runCapabilitiesBtn.innerHTML = "<span class='loading'>‚è≥</span><span>Running‚Ä¶</span>";
      setBadgeState(capStatusBadge, capStatusText, "warn", "Detecting‚Ä¶");

      try {
        const caps = await PublicKeyCredential.getClientCapabilities();
        capLog.textContent = JSON.stringify(caps, null, 2);
        capLogLabel.textContent = "Capabilities result";
        capLogMeta.textContent = new Date().toLocaleTimeString();

        renderCapabilities(caps);

        const total = Object.keys(caps).length;
        const supported = Object.values(caps).filter(v => v === true).length;
        setBadgeState(capStatusBadge, capStatusText, "ok", `${supported}/${total} supported`);
        copyCapabilitiesBtn.disabled = false;
      } catch (err) {
        setBadgeState(capStatusBadge, capStatusText, "error", "Error");
        capLog.textContent = JSON.stringify({ error: err.message, name: err.name }, null, 2);
      } finally {
        runCapabilitiesBtn.disabled = false;
        runCapabilitiesBtn.innerHTML = "<span>‚ñ∂</span><span>Run Check</span>";
      }
    }

    async function copyCapabilitiesJSON() {
      try {
        await navigator.clipboard.writeText(capLog.textContent);
        copyCapabilitiesBtn.innerHTML = "<span>‚úì</span><span>Copied!</span>";
        setTimeout(() => { copyCapabilitiesBtn.innerHTML = "<span>‚ßâ</span><span>Copy JSON</span>"; }, 1200);
      } catch {
        copyCapabilitiesBtn.innerHTML = "<span>‚úó</span><span>Failed</span>";
        setTimeout(() => { copyCapabilitiesBtn.innerHTML = "<span>‚ßâ</span><span>Copy JSON</span>"; }, 1200);
      }
    }

    runCapabilitiesBtn.addEventListener("click", runCapabilitiesCheck);
    copyCapabilitiesBtn.addEventListener("click", copyCapabilitiesJSON);

    // =========================================================================
    // Hints Section
    // =========================================================================
    let selectedHints = [];

    hintOptions.querySelectorAll(".hint-option").forEach(option => {
      option.addEventListener("click", () => {
        const hint = option.dataset.hint;
        const input = option.querySelector("input");

        if (selectedHints.includes(hint)) {
          selectedHints = selectedHints.filter(h => h !== hint);
          option.classList.remove("selected");
          input.checked = false;
        } else {
          selectedHints.push(hint);
          option.classList.add("selected");
          input.checked = true;
        }

        updateHintCode();
      });
    });

    function updateHintCode() {
      if (selectedHints.length === 0) {
        hintCode.textContent = "hints: []";
        } else {
        hintCode.textContent = `hints: [${selectedHints.map(h => `"${h}"`).join(", ")}]`;
      }
    }

    function showHintTestResult(success, message, details = null) {
      hintTestResult.style.display = "block";
      hintTestResultContent.innerHTML = `
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
          <span class="dot-indicator ${success ? 'ok' : 'no'}"></span>
          <strong style="color: ${success ? 'var(--success)' : 'var(--danger)'}">
            ${success ? 'Success' : 'Error / Cancelled'}
          </strong>
        </div>
        <p style="margin: 0; font-size: 0.82rem; color: var(--text-muted);">${message}</p>
        ${details ? `<pre style="margin: 8px 0 0; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 8px; font-size: 0.75rem; overflow: auto;">${details}</pre>` : ''}
      `;
    }

    async function testHintsWithCreate() {
      if (typeof PublicKeyCredential === "undefined") {
        showHintTestResult(false, "WebAuthn is not available on this platform.");
        return;
      }

      testHintsCreateBtn.disabled = true;
      testHintsCreateBtn.innerHTML = "<span class='loading'>‚è≥</span><span>Testing‚Ä¶</span>";

      // Generate random values for the test
      const challenge = new Uint8Array(32);
      crypto.getRandomValues(challenge);
      const userId = new Uint8Array(16);
      crypto.getRandomValues(userId);

      const createOptions = {
        publicKey: {
          challenge: challenge,
          rp: {
            name: "WebAuthn Explorer Test",
            id: window.location.hostname
          },
          user: {
            id: userId,
            name: "test@example.com",
            displayName: "Test User"
          },
          pubKeyCredParams: [
            { type: "public-key", alg: -7 },   // ES256
            { type: "public-key", alg: -257 }  // RS256
          ],
          authenticatorSelection: {
            userVerification: "preferred"
          },
          timeout: 60000,
          hints: selectedHints.length > 0 ? selectedHints : undefined
        }
      };

      try {
        const credential = await navigator.credentials.create(createOptions);
        showHintTestResult(
          true,
          `Credential created successfully with hints: [${selectedHints.join(", ") || "none"}]`,
          `Credential ID: ${btoa(String.fromCharCode(...new Uint8Array(credential.rawId))).slice(0, 40)}...`
        );
      } catch (err) {
        showHintTestResult(
          false,
          `${err.name}: ${err.message}`,
          `Hints used: [${selectedHints.join(", ") || "none"}]`
        );
      } finally {
        testHintsCreateBtn.disabled = false;
        testHintsCreateBtn.innerHTML = "<span>‚ú®</span><span>Test with Create</span>";
      }
    }

    async function testHintsWithGet() {
      if (typeof PublicKeyCredential === "undefined") {
        showHintTestResult(false, "WebAuthn is not available on this platform.");
        return;
      }

      testHintsGetBtn.disabled = true;
      testHintsGetBtn.innerHTML = "<span class='loading'>‚è≥</span><span>Testing‚Ä¶</span>";

      const challenge = new Uint8Array(32);
      crypto.getRandomValues(challenge);

      const getOptions = {
        publicKey: {
          challenge: challenge,
          rpId: window.location.hostname,
          userVerification: "preferred",
          timeout: 60000,
          hints: selectedHints.length > 0 ? selectedHints : undefined
        }
      };

      try {
        const assertion = await navigator.credentials.get(getOptions);
        showHintTestResult(
          true,
          `Authentication successful with hints: [${selectedHints.join(", ") || "none"}]`,
          `Credential ID: ${btoa(String.fromCharCode(...new Uint8Array(assertion.rawId))).slice(0, 40)}...`
        );
      } catch (err) {
        showHintTestResult(
          false,
          `${err.name}: ${err.message}`,
          `Hints used: [${selectedHints.join(", ") || "none"}]\n\nNote: "Get" requires an existing credential for this origin.`
        );
      } finally {
        testHintsGetBtn.disabled = false;
        testHintsGetBtn.innerHTML = "<span>üîì</span><span>Test with Get</span>";
      }
    }

    testHintsCreateBtn.addEventListener("click", testHintsWithCreate);
    testHintsGetBtn.addEventListener("click", testHintsWithGet);

    // =========================================================================
    // Initialize
    // =========================================================================
    updateEnvironment();
  </script>
</body>
</html>
